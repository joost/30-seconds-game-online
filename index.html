<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta
      name="viewport"
      content="width=device-width, initial-scale=1.0, 
                 user-scalable=no, 
                 initial-scale=1.0, 
                 maximum-scale=1.0"
    />
    <title>30 Seconds Game</title>

    <!-- Bootstrap 5 CSS (CDN) -->
    <link
      rel="stylesheet"
      href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css"
    />

    <style>
      /* Body & Container Setup */
      html,
      body {
        height: 100%;
        margin: 0;
        padding: 0;
        overflow: hidden; /* Prevent scrolling on mobile */
      }
      body {
        display: flex;
        align-items: center;
        justify-content: center;
        background-color: #f8f9fa;
      }

      /* Card Flipping Container */
      .flip-container {
        perspective: 1000px; /* for 3D flip effect */
        width: 320px;
        height: 350px;
        position: relative;
      }
      /* .flipper holds front and back faces */
      .flipper {
        width: 100%;
        height: 100%;
        position: absolute;
        transform-style: preserve-3d;
        transition: transform 0.8s;
      }
      /* Add .flipped to rotate */
      .flipped {
        transform: rotateY(180deg);
      }

      /* Front and Back faces of the card */
      .front,
      .back {
        position: absolute;
        width: 100%;
        height: 100%;
        backface-visibility: hidden;
        top: 0;
        left: 0;
        border-radius: 0.5rem;
        border: 1px solid rgba(0, 0, 0, 0.125);
        background-color: #fff;
        box-shadow: 0 4px 8px rgba(0, 0, 0, 0.2);
        display: flex;
        flex-direction: column;
        justify-content: space-between;
      }
      .front .card-body,
      .back .card-body {
        overflow: hidden;
      }
      .back {
        transform: rotateY(180deg);
      }

      /* Keep the card content comfortably spaced */
      .card-body {
        padding: 1rem;
      }

      /* Timer text (larger, centered) */
      #timerValue {
        font-size: 2rem;
        text-align: center;
      }

      /* Make sure it fits smaller devices */
      @media (max-width: 350px) {
        .flip-container {
          width: 280px;
          height: 420px;
        }
      }
    </style>
  </head>
  <body>
    <div class="flip-container">
      <div class="flipper" id="cardFlipper">
        <!-- FRONT FACE -->
        <div class="front d-flex flex-column" id="cardFront">
          <div class="card-body">
            <!-- Removed “Describe These!” heading -->
            <ul class="list-group mb-3" id="cardItems"></ul>
          </div>
          <div class="p-2">
            <!-- Timer display + progress bar -->
            <div id="timerValue">30</div>
            <div class="progress mt-2" style="height: 8px">
              <div
                class="progress-bar bg-warning"
                role="progressbar"
                id="timerBar"
                style="width: 100%"
                aria-valuenow="100"
                aria-valuemin="0"
                aria-valuemax="100"
              ></div>
            </div>
          </div>
        </div>

        <!-- BACK FACE -->
        <div class="back d-flex flex-column">
          <div class="card-body">
            <div class="mb-3">
              <h5 class="card-title">Time is up! (or you flipped)</h5>
              <p>Now pick your next card or go back.</p>
            </div>
            <div class="d-flex justify-content-around">
              <button id="btnBack" class="btn btn-secondary">Back</button>
              <button id="btnNext" class="btn btn-primary">Next</button>
            </div>
          </div>
        </div>
      </div>
    </div>

    <!-- Bootstrap 5 Bundle (with Popper) -->
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>

    <script>
      const TIME_LIMIT = 30; // total seconds
      let cardsData = [];
      let currentCardIndex = 0;
      let intervalId = null;
      let timeRemaining = TIME_LIMIT;

      const cardFlipper = document.getElementById("cardFlipper");
      const cardItems = document.getElementById("cardItems");
      const timerValue = document.getElementById("timerValue");
      const timerBar = document.getElementById("timerBar");

      const cardFront = document.getElementById("cardFront");
      const btnBack = document.getElementById("btnBack");
      const btnNext = document.getElementById("btnNext");

      // 1) Fetch the cards.json data
      fetch("cards.json")
        .then((response) => response.json())
        .then((data) => {
          cardsData = data.cards; // Array of arrays
          // Show the first card
          showCard(currentCardIndex);
          // Start the timer for the first card
          startTimer();
        })
        .catch((err) => console.error("Error loading cards.json:", err));

      // 2) Display the card at the given index
      function showCard(index) {
        if (index >= cardsData.length) {
          // If we've shown all cards, just show "Game Over"
          cardItems.innerHTML = `<li class="list-group-item">Game Over</li>`;
          return;
        }

        // Clear any previous items
        cardItems.innerHTML = "";

        // Fill in the 5 items from the JSON
        const currentItems = cardsData[index];
        currentItems.forEach((item) => {
          const li = document.createElement("li");
          li.className = "list-group-item";
          li.textContent = item;
          cardItems.appendChild(li);
        });
      }

      // 3) Timer logic (30s countdown)
      function startTimer() {
        // If there was an existing timer, clear it first
        if (intervalId) {
          clearInterval(intervalId);
        }

        timeRemaining = TIME_LIMIT;
        updateTimerUI();

        intervalId = setInterval(() => {
          timeRemaining--;
          if (timeRemaining < 0) {
            // Timer ended: flip the card to show the back
            flipCard();
            // Automatically move to next card after a brief delay (optional)
            // setTimeout(() => {
            //   flipCard(); // flip back to front for next card
            //   currentCardIndex++;
            //   if (currentCardIndex < cardsData.length) {
            //     showCard(currentCardIndex);
            //     // Start a fresh timer
            //     startTimer();
            //   } else {
            //     // No more cards
            //     clearInterval(intervalId);
            //     cardItems.innerHTML = `<li class="list-group-item">Game Over</li>`;
            //   }
            // }, 1500);

            clearInterval(intervalId);
            return;
          }
          updateTimerUI();
        }, 1000);
      }

      function updateTimerUI() {
        timerValue.textContent = timeRemaining;
        const pct = (timeRemaining / TIME_LIMIT) * 100;
        timerBar.style.width = pct + "%";
        timerBar.setAttribute("aria-valuenow", pct);
      }

      // 4) Clicking the FRONT of the card flips it to show the back
      cardFront.addEventListener("click", () => {
        if (!cardFlipper.classList.contains("flipped")) {
          flipCard();
        }
      });

      // 5) Flip the card programmatically
      function flipCard() {
        cardFlipper.classList.toggle("flipped");
      }

      // 6) Buttons on the BACK face
      btnBack.addEventListener("click", () => {
        // Flip to front if we're on the back
        if (cardFlipper.classList.contains("flipped")) {
          flipCard();
        }
      });

      btnNext.addEventListener("click", () => {
        // Move to next card
        currentCardIndex++;
        if (currentCardIndex < cardsData.length) {
          showCard(currentCardIndex);
          // Flip to front if currently on the back
          if (cardFlipper.classList.contains("flipped")) {
            flipCard();
          }
          // Start (or restart) the timer for the new card
          startTimer();
        } else {
          // All cards done
          clearInterval(intervalId);
          cardItems.innerHTML = `<li class="list-group-item">Game Over</li>`;
          if (cardFlipper.classList.contains("flipped")) {
            flipCard();
          }
        }
      });
    </script>
  </body>
</html>
