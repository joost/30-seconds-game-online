<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta
      name="viewport"
      content="width=device-width, initial-scale=1.0, 
                 user-scalable=no, 
                 initial-scale=1.0, 
                 maximum-scale=1.0"
    />
    <title>30 Seconds Game</title>

    <!-- Bootstrap 5 CSS (CDN) -->
    <link
      rel="stylesheet"
      href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css"
    />

    <style>
      /* Body & Container Setup */
      html,
      body {
        height: 100%;
        margin: 0;
        padding: 0;
        overflow: hidden; /* Prevent scrolling on mobile */
      }
      body {
        display: flex;
        align-items: center;
        justify-content: center;
        background-color: #f8f9fa;
      }

      /* Card Flipping Container */
      .flip-container {
        perspective: 1000px; /* for 3D flip effect */
        width: 320px;
        height: 480px;
        position: relative;
      }
      /* .flipper holds front and back faces */
      .flipper {
        width: 100%;
        height: 100%;
        position: absolute;
        transform-style: preserve-3d;
        transition: transform 0.8s;
      }
      /* Add .flipped to rotate */
      .flipped {
        transform: rotateY(180deg);
      }

      /* Front and Back faces of the card */
      .front,
      .back {
        position: absolute;
        width: 100%;
        height: 100%;
        backface-visibility: hidden;
        top: 0;
        left: 0;
        border-radius: 0.5rem;
        border: 1px solid rgba(0, 0, 0, 0.125);
        background-color: #fff;
        box-shadow: 0 4px 8px rgba(0, 0, 0, 0.2);
        display: flex;
        flex-direction: column;
        justify-content: space-between;
      }
      .front .card-body,
      .back .card-body {
        overflow: hidden;
      }
      .back {
        transform: rotateY(180deg);
      }

      /* Keep the card content comfortably spaced */
      .card-body {
        padding: 1rem;
      }

      /* Center text in the "back" just for demonstration */
      .back .card-body {
        display: flex;
        align-items: center;
        justify-content: center;
        text-align: center;
      }

      /* Timer text (larger, centered) */
      #timerValue {
        font-size: 2rem;
        text-align: center;
      }

      /* Make sure it fits smaller devices */
      @media (max-width: 350px) {
        .flip-container {
          width: 280px;
          height: 420px;
        }
      }
    </style>
  </head>
  <body>
    <div class="flip-container">
      <div class="flipper" id="cardFlipper">
        <!-- FRONT FACE -->
        <div class="front d-flex flex-column">
          <div class="card-body">
            <h5 class="card-title text-center">Describe These!</h5>
            <ul class="list-group mb-3" id="cardItems"></ul>
          </div>
          <div class="p-2">
            <!-- Timer display + progress bar -->
            <div id="timerValue">30</div>
            <div class="progress mt-2" style="height: 8px">
              <div
                class="progress-bar bg-warning"
                role="progressbar"
                id="timerBar"
                style="width: 100%"
                aria-valuenow="100"
                aria-valuemin="0"
                aria-valuemax="100"
              ></div>
            </div>
          </div>
        </div>

        <!-- BACK FACE (Example: Next Card or "Time's up!") -->
        <div class="back d-flex flex-column">
          <div class="card-body">
            <h5 class="card-title">Time is up!</h5>
            <p>Tap again for the next card.</p>
          </div>
        </div>
      </div>
    </div>

    <!-- Bootstrap 5 Bundle (with Popper) -->
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>

    <script>
      const TIME_LIMIT = 30; // total seconds
      let cardsData = [];
      let currentCardIndex = 0;
      let intervalId = null;
      let timeRemaining = TIME_LIMIT;

      const cardFlipper = document.getElementById("cardFlipper");
      const cardItems = document.getElementById("cardItems");
      const timerValue = document.getElementById("timerValue");
      const timerBar = document.getElementById("timerBar");

      // 1) Fetch the cards.json data
      fetch("cards.json")
        .then((response) => response.json())
        .then((data) => {
          cardsData = data.cards; // Array of arrays
          // Show first card
          showCard(0);
          // Start the timer
          startTimer();
        })
        .catch((err) => console.error("Error loading cards.json:", err));

      // 2) Show the card at the given index
      function showCard(index) {
        if (index >= cardsData.length) {
          // If we've shown all cards, just show an empty or "Game Over" message
          cardItems.innerHTML = `<li class="list-group-item">Game Over</li>`;
          return;
        }

        // Clear any previous items
        cardItems.innerHTML = "";

        // Fill in the 5 items from the JSON
        const currentItems = cardsData[index];
        currentItems.forEach((item) => {
          const li = document.createElement("li");
          li.className = "list-group-item";
          li.textContent = item;
          cardItems.appendChild(li);
        });
      }

      // 3) Timer logic (30s countdown)
      function startTimer() {
        timeRemaining = TIME_LIMIT;
        updateTimerUI();

        intervalId = setInterval(() => {
          timeRemaining--;
          if (timeRemaining < 0) {
            // Timer ended: flip the card to show the "back"
            flipCard();

            // Wait a moment, then move on to the next card
            setTimeout(() => {
              // Flip back so user sees the new front
              flipCard();
              // Move to next card
              currentCardIndex++;
              if (currentCardIndex < cardsData.length) {
                showCard(currentCardIndex);
                // Reset timer
                timeRemaining = TIME_LIMIT;
                updateTimerUI();
              } else {
                // No more cards
                clearInterval(intervalId);
              }
            }, 1500);

            clearInterval(intervalId);
            return;
          }
          updateTimerUI();
        }, 1000);
      }

      // 4) Update the timer text + progress bar
      function updateTimerUI() {
        timerValue.textContent = timeRemaining;
        const pct = (timeRemaining / TIME_LIMIT) * 100;
        timerBar.style.width = pct + "%";
        timerBar.setAttribute("aria-valuenow", pct);
      }

      // 5) Flip the card on click/tap
      cardFlipper.addEventListener("click", () => {
        // If the timer hasnâ€™t ended, you could allow flipping manually:
        flipCard();
      });

      function flipCard() {
        cardFlipper.classList.toggle("flipped");
      }
    </script>
  </body>
</html>
