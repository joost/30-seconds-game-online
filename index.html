<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta
      name="viewport"
      content="width=device-width, 
                 initial-scale=1.0, 
                 user-scalable=no, 
                 maximum-scale=1.0"
    />
    <title>30 Seconds Game (Multi-Language)</title>

    <!-- Bootstrap 5 CSS (CDN) -->
    <link
      rel="stylesheet"
      href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css"
    />

    <!-- Flag Icon CSS (CDN) -->
    <!-- For documentation, see: https://github.com/lipis/flag-icons -->
    <link
      rel="stylesheet"
      href="https://cdnjs.cloudflare.com/ajax/libs/flag-icon-css/6.6.6/css/flag-icons.min.css"
      integrity="sha512-ZDypKxybqdW4+7ehzK8TexYeA1GGARHovxhPNR5anK6QLnHJKGk8PGtASbYpV4gRAKNvpMEHu8u2ZhXz9Q6h/A=="
      crossorigin="anonymous"
      referrerpolicy="no-referrer"
    />

    <style>
      /* Body & Container Setup */
      html,
      body {
        height: 100%;
        margin: 0;
        padding: 0;
        overflow: hidden; /* Prevent scrolling on mobile */
      }
      body {
        display: flex;
        flex-direction: column;
        background-color: #f8f9fa;
      }

      /* Language Bar at the top */
      .language-bar {
        flex-shrink: 0;
        background-color: #fff;
        border-bottom: 1px solid #ccc;
        display: flex;
        justify-content: center;
        align-items: center;
        padding: 0.5rem;
      }
      .language-bar .btn {
        margin: 0 0.25rem;
      }
      .language-bar i {
        margin-right: 0.25rem;
      }

      /* Main content area: center the card */
      .main-container {
        flex: 1;
        display: flex;
        align-items: center;
        justify-content: center;
      }

      /* Card Flipping Container */
      .flip-container {
        perspective: 1000px; /* for 3D flip effect */
        width: 320px;
        height: 350px;
        position: relative;
      }
      /* .flipper holds front and back faces */
      .flipper {
        width: 100%;
        height: 100%;
        position: absolute;
        transform-style: preserve-3d;
        transition: transform 0.8s;
      }
      /* Add .flipped to rotate */
      .flipped {
        transform: rotateY(180deg);
      }

      /* Front and Back faces of the card */
      .front,
      .back {
        position: absolute;
        width: 100%;
        height: 100%;
        backface-visibility: hidden;
        top: 0;
        left: 0;
        border-radius: 0.5rem;
        border: 1px solid rgba(0, 0, 0, 0.125);
        background-color: #fff;
        box-shadow: 0 4px 8px rgba(0, 0, 0, 0.2);
        display: flex;
        flex-direction: column;
        justify-content: space-between;
      }
      .front .card-body,
      .back .card-body {
        overflow: hidden;
      }
      .back {
        transform: rotateY(180deg);
      }

      /* Keep the card content comfortably spaced */
      .card-body {
        padding: 1rem;
      }

      /* Timer text (larger, centered) */
      #timerValue {
        font-size: 2rem;
        text-align: center;
      }

      /* Make sure it fits smaller devices */
      @media (max-width: 350px) {
        .flip-container {
          width: 280px;
          height: 420px;
        }
      }
    </style>
  </head>
  <body>
    <!-- Language Switcher Bar -->
    <div class="language-bar">
      <div class="btn-group" role="group">
        <!-- Each button uses a flag-icon class instead of an <img> -->
        <button type="button" class="btn btn-light" id="lang-nl">
          <span class="flag-icon flag-icon-nl"></span> NL
        </button>
        <button type="button" class="btn btn-light" id="lang-fr">
          <span class="flag-icon flag-icon-fr"></span> FR
        </button>
        <button type="button" class="btn btn-light" id="lang-de">
          <span class="flag-icon flag-icon-de"></span> DE
        </button>
        <button type="button" class="btn btn-light" id="lang-en">
          <span class="flag-icon flag-icon-gb"></span> EN
        </button>
      </div>
    </div>

    <!-- Main Container with the flipping card -->
    <div class="main-container">
      <div class="flip-container">
        <div class="flipper" id="cardFlipper">
          <!-- FRONT FACE -->
          <div class="front d-flex flex-column" id="cardFront">
            <div class="card-body">
              <ul class="list-group mb-3" id="cardItems"></ul>
            </div>
            <div class="p-2">
              <!-- Timer display + progress bar -->
              <div id="timerValue">30</div>
              <div class="progress mt-2" style="height: 8px">
                <div
                  class="progress-bar bg-warning"
                  role="progressbar"
                  id="timerBar"
                  style="width: 100%"
                  aria-valuenow="100"
                  aria-valuemin="0"
                  aria-valuemax="100"
                ></div>
              </div>
            </div>
          </div>

          <!-- BACK FACE -->
          <div class="back d-flex flex-column">
            <div class="card-body">
              <div class="mb-3">
                <h5 class="card-title">Time is up! (or you flipped)</h5>
                <p>Pick your next card or go back.</p>
              </div>
              <div class="d-flex justify-content-around">
                <button id="btnBack" class="btn btn-secondary">Back</button>
                <button id="btnNext" class="btn btn-primary">Next</button>
              </div>
            </div>
          </div>
        </div>
      </div>
    </div>

    <!-- Bootstrap 5 Bundle (with Popper) -->
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>

    <script>
      // Globals
      const TIME_LIMIT = 30; // total seconds
      let cardsData = []; // current language's set of cards
      let currentCardIndex = 0;
      let intervalId = null;
      let timeRemaining = TIME_LIMIT;

      // UI Elements
      const cardFlipper = document.getElementById("cardFlipper");
      const cardFront = document.getElementById("cardFront");
      const cardItems = document.getElementById("cardItems");
      const timerValue = document.getElementById("timerValue");
      const timerBar = document.getElementById("timerBar");
      const btnBack = document.getElementById("btnBack");
      const btnNext = document.getElementById("btnNext");

      // Language buttons
      const langNl = document.getElementById("lang-nl");
      const langFr = document.getElementById("lang-fr");
      const langDe = document.getElementById("lang-de");
      const langEn = document.getElementById("lang-en");

      // Initially load a default language, e.g., English
      loadLanguage("en");

      // Click handlers for the language switcher
      langNl.addEventListener("click", () => loadLanguage("nl"));
      langFr.addEventListener("click", () => loadLanguage("fr"));
      langDe.addEventListener("click", () => loadLanguage("de"));
      langEn.addEventListener("click", () => loadLanguage("en"));

      // Loads the JSON file for the given language, randomizes the cards, starts the game
      function loadLanguage(lang) {
        const fileName = `cards-${lang}.json`;

        // Stop any running timer
        if (intervalId) {
          clearInterval(intervalId);
          intervalId = null;
        }

        fetch(fileName)
          .then((resp) => resp.json())
          .then((data) => {
            cardsData = data.cards;

            // Randomize the order of the cards
            shuffle(cardsData);

            currentCardIndex = 0;
            showCard(currentCardIndex);
            startTimer();

            // If the card is flipped, flip it back to front
            if (cardFlipper.classList.contains("flipped")) {
              flipCard();
            }
          })
          .catch((err) => {
            console.error(`Error loading ${fileName}:`, err);
            cardItems.innerHTML = `<li class="list-group-item text-danger">Error loading ${fileName}</li>`;
          });
      }

      // Simple array shuffle (Fisherâ€“Yates)
      function shuffle(array) {
        for (let i = array.length - 1; i > 0; i--) {
          const j = Math.floor(Math.random() * (i + 1));
          [array[i], array[j]] = [array[j], array[i]];
        }
      }

      // Display the card at the given index
      function showCard(index) {
        if (!cardsData || index >= cardsData.length) {
          cardItems.innerHTML = `<li class="list-group-item">Game Over</li>`;
          return;
        }

        cardItems.innerHTML = "";
        const currentItems = cardsData[index];
        currentItems.forEach((item) => {
          const li = document.createElement("li");
          li.className = "list-group-item";
          li.textContent = item;
          cardItems.appendChild(li);
        });
      }

      // 30-second countdown timer
      function startTimer() {
        // Clear any existing interval
        if (intervalId) {
          clearInterval(intervalId);
        }

        timeRemaining = TIME_LIMIT;
        updateTimerUI();

        intervalId = setInterval(() => {
          timeRemaining--;
          if (timeRemaining < 0) {
            // Timer ended: flip the card to show the back
            flipCard();
            // // Move to next card after a short delay
            // setTimeout(() => {
            //   flipCard();
            //   currentCardIndex++;
            //   if (currentCardIndex < cardsData.length) {
            //     showCard(currentCardIndex);
            //     startTimer();
            //   } else {
            //     // No more cards
            //     clearInterval(intervalId);
            //     cardItems.innerHTML = `<li class="list-group-item">Game Over</li>`;
            //   }
            // }, 1500);

            clearInterval(intervalId);
            return;
          }
          updateTimerUI();
        }, 1000);
      }

      // Update timer text + progress bar
      function updateTimerUI() {
        timerValue.textContent = timeRemaining;
        const pct = (timeRemaining / TIME_LIMIT) * 100;
        timerBar.style.width = pct + "%";
        timerBar.setAttribute("aria-valuenow", pct);
      }

      // Clicking the FRONT of the card flips it (if not already flipped)
      cardFront.addEventListener("click", () => {
        if (!cardFlipper.classList.contains("flipped")) {
          flipCard();
        }
      });

      // Flip the card
      function flipCard() {
        cardFlipper.classList.toggle("flipped");
      }

      // Buttons on the BACK face
      btnBack.addEventListener("click", () => {
        // Flip to front if we're on the back
        if (cardFlipper.classList.contains("flipped")) {
          flipCard();
        }
      });

      btnNext.addEventListener("click", () => {
        // Move to next card
        currentCardIndex++;
        if (currentCardIndex < cardsData.length) {
          showCard(currentCardIndex);
          // Flip to front if on the back
          if (cardFlipper.classList.contains("flipped")) {
            flipCard();
          }
          startTimer();
        } else {
          // All cards done
          clearInterval(intervalId);
          cardItems.innerHTML = `<li class="list-group-item">Game Over</li>`;
          if (cardFlipper.classList.contains("flipped")) {
            flipCard();
          }
        }
      });
    </script>
  </body>
</html>
